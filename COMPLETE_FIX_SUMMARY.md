# ‚úÖ –ü–æ–ª–Ω–æ–µ —Ä–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå SMTP - –ö–æ–¥ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –ø–æ—á—Ç—É
**–ü—Ä–æ–±–ª–µ–º–∞:** `Missing credentials for "PLAIN"` - PM2 –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env`

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –Ø–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ `.env` —Ñ–∞–π–ª–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—É—Ç–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è SMTP –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ PM2 ecosystem –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `apps/backend/src/index.ts` - –∑–∞–≥—Ä—É–∑–∫–∞ .env —Å –ª–æ–≥–∞–º–∏
- `apps/backend/src/utils/email.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `apps/backend/ecosystem.config.cjs` - PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

### 2. ‚ùå React - Invalid hook call –≤ RegisterPage
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ React –≤ bundle –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö dependencies –≤ `@woxly/ui`

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª React –∏–∑ `dependencies` –≤ `peerDependencies` –≤ –ø–∞–∫–µ—Ç–µ `@woxly/ui`
- ‚úÖ –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ frontend

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `packages/ui/package.json` - React —Ç–µ–ø–µ—Ä—å peerDependency

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—á–µ—Ä–µ–∑ SSH)

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ñ–∞–π–ª–∞ `deploy-commands.txt` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
ssh root@VM-396498

# –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ deploy-commands.txt
cd /var/www/woxly
git pull origin main
cd apps/backend
npm install
npm run build
pm2 delete woxly-backend
pm2 start ecosystem.config.cjs
pm2 save
sleep 3
pm2 logs woxly-backend --lines 50 | grep -i "smtp\|environment"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `deploy-commands.txt` –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ –ø–æ—Ä—è–¥–∫—É.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SMTP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@VM-396498

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
pm2 logs woxly-backend --lines 50 | grep SMTP
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Environment variables loaded from: /var/www/woxly/apps/backend/.env
SMTP_USER: ‚úì SET
SMTP_PASS: ‚úì SET
SMTP_HOST: smtp.gmail.com
```

### 2. –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ email

```bash
# –° —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
curl -X POST https://woxly.ru/api/auth/request-password-reset \
  -H "Content-Type: application/json" \
  -d '{"email":"ilyalove130919@gmail.com"}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥–∞—Ö:**
```
Attempting to send –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è email to ilyalove130919@gmail.com
SMTP Config: { host: 'smtp.gmail.com', ... }
Email sent successfully to ilyalove130919@gmail.com: <message-id>
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å React –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –í –ª–æ–∫–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
cd C:\woxly\apps\frontend
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/auth/register` - –æ—à–∏–±–æ–∫ React –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ.

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

1. **QUICK_DEPLOY.md** - –±—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
2. **SMTP_FIX_README.md** - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ SMTP –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. **SMTP_FIX_INSTRUCTIONS.md** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ —à–∞–≥–∞–º
4. **deploy-commands.txt** - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
5. **deploy-smtp-fix.ps1** - PowerShell —Å–∫—Ä–∏–ø—Ç (–µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π)
6. **deploy-smtp-fix.sh** - Bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è Linux/Mac
7. **COMPLETE_FIX_SUMMARY.md** - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å SMTP fix –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ `deploy-commands.txt`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PM2
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É email

2. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:**
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä frontend: `npm run dev`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ RegisterPage —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ React

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è email

---

## üìù Git –∫–æ–º–º–∏—Ç—ã

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã:

1. `667125d` - Fix SMTP email sending with proper environment variable loading
2. `54bc64d` - Fix React duplicate instance error by moving React to peerDependencies
3. `8e76884` - Add manual deployment commands for server

---

## ‚ùì –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### SMTP –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `cat /var/www/woxly/apps/backend/.env | grep SMTP`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Gmail App Password: https://myaccount.google.com/apppasswords
3. –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `SMTP_FIX_INSTRUCTIONS.md`

### React –æ—à–∏–±–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:
1. –û—á–∏—Å—Ç–∏—Ç–µ node_modules: `rm -rf apps/frontend/node_modules packages/ui/node_modules`
2. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `npm install --workspace=apps/frontend --workspace=packages/ui`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

- [x] SMTP –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ
- [x] React –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ  
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã –≤ GitHub
- [ ] **TODO: –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä** (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ deploy-commands.txt)
- [ ] **TODO: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email**
- [ ] **TODO: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Å –∫–æ–¥–æ–º**

–£–¥–∞—á–∏! üöÄ
