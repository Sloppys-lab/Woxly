<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WOXLY Loading</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: #2f3136; /* Discord —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π */
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      position: relative;
      animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      will-change: opacity;
    }

    body.fade-out {
      animation: fadeOut 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    /* –î–ª—è —Å–ª–∞–±—ã—Ö –ü–ö */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
      }
    }

    /* –†–∞–¥–∏–∞–ª—å–Ω–æ–µ –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
    body::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(114, 137, 218, 0.08) 0%, transparent 70%);
      animation: pulseGlow 4s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes pulseGlow {
      0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .container {
      text-align: center;
      position: relative;
      z-index: 10;
      animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) 0.1s backwards;
      will-change: transform, opacity;
    }

    @keyframes scaleIn {
      from { 
        opacity: 0; 
        transform: scale(0.9);
      }
      to { 
        opacity: 1; 
        transform: scale(1);
      }
    }

    /* –õ–æ–≥–æ—Ç–∏–ø (–∏–∫–æ–Ω–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–∞–∫ Discord) */
    .logo-container {
      width: 80px;
      height: 80px;
      margin: 0 auto 32px;
      position: relative;
      animation: logoFloat 3s ease-in-out infinite;
    }

    @keyframes logoFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    .logo-icon {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #7289da 0%, #5865f2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: 900;
      color: white;
      box-shadow: 0 8px 24px rgba(114, 137, 218, 0.3);
      position: relative;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { box-shadow: 0 8px 24px rgba(114, 137, 218, 0.3); }
      50% { box-shadow: 0 8px 32px rgba(114, 137, 218, 0.5); }
    }

    /* –í—Ä–∞—â–∞—é—â–µ–µ—Å—è –∫–æ–ª—å—Ü–æ */
    .logo-ring {
      position: absolute;
      inset: -8px;
      border: 2px solid transparent;
      border-top-color: rgba(114, 137, 218, 0.4);
      border-radius: 50%;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* –°—Ç–∞—Ç—É—Å —Å –∏–∫–æ–Ω–∫–æ–π */
    .status {
      font-size: 15px;
      font-weight: 500;
      color: #b9bbbe;
      margin-bottom: 24px;
      min-height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      animation: statusFade 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes statusFade {
      from { 
        opacity: 0;
        transform: translateY(8px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status-icon {
      font-size: 14px;
      animation: iconSpin 1s linear infinite;
    }

    @keyframes iconSpin {
      to { transform: rotate(360deg); }
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
    .progress-container {
      position: relative;
      margin-bottom: 16px;
      width: 280px;
      margin-left: auto;
      margin-right: auto;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #7289da 0%, #5865f2 100%);
      border-radius: 8px;
      transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      position: relative;
      box-shadow: 0 0 16px rgba(114, 137, 218, 0.4);
      will-change: width;
    }

    /* Shimmer –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ */
    .progress-fill::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s linear infinite;
    }

    @keyframes shimmer {
      from { transform: translateX(-100%); }
      to { transform: translateX(200%); }
    }

    /* –°–≤–µ—Ç—è—â–∏–π—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
    .progress-indicator {
      position: absolute;
      top: 50%;
      left: 0%;
      width: 12px;
      height: 12px;
      transform: translate(-50%, -50%);
      background: #ffffff;
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(114, 137, 218, 0.8);
      transition: left 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      animation: indicatorPulse 1.5s ease-in-out infinite;
      pointer-events: none;
      will-change: left;
    }

    @keyframes indicatorPulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.8; }
    }

    /* –ü—Ä–æ—Ü–µ–Ω—Ç –∏ –≤—Ä–µ–º—è */
    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 12px;
      color: #72767d;
      font-weight: 500;
    }

    .progress-percent {
      font-variant-numeric: tabular-nums;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .progress-percent.updating {
      color: #7289da;
      transform: scale(1.1);
    }

    .progress-time {
      font-variant-numeric: tabular-nums;
    }

    /* –í–µ—Ä—Å–∏—è */
    .version {
      font-size: 11px;
      color: #4f545c;
      margin-top: 24px;
      font-weight: 500;
    }

    /* Skip –∫–Ω–æ–ø–∫–∞ (—Ç–æ–ª—å–∫–æ –≤ dev) */
    .skip-button {
      position: absolute;
      bottom: 16px;
      right: 16px;
      padding: 6px 12px;
      background: rgba(114, 137, 218, 0.2);
      border: 1px solid rgba(114, 137, 218, 0.3);
      border-radius: 6px;
      color: #7289da;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
      display: none;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .skip-button.show {
      display: block;
    }

    .skip-button:hover {
      background: rgba(114, 137, 218, 0.3);
      transform: scale(1.05);
    }

    .skip-button:active {
      transform: scale(0.95);
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
    .update-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 360px;
      padding: 32px;
      background: #36393f;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      text-align: center;
      display: none;
      animation: modalSlide 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      z-index: 100;
    }

    .update-notification.show {
      display: block;
    }

    @keyframes modalSlide {
      from { 
        opacity: 0; 
        transform: translate(-50%, -45%) scale(0.95);
      }
      to { 
        opacity: 1; 
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .update-icon {
      font-size: 48px;
      margin-bottom: 16px;
      animation: iconBounce 2s ease-in-out infinite;
    }

    @keyframes iconBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .update-title {
      font-size: 20px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 8px;
    }

    .update-version {
      font-size: 16px;
      font-weight: 600;
      color: #7289da;
      margin-bottom: 16px;
    }

    .update-description {
      font-size: 14px;
      color: #b9bbbe;
      line-height: 1.5;
      margin-bottom: 24px;
    }

    .update-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 4px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .btn-primary {
      background: #5865f2;
      color: white;
    }

    .btn-primary:hover {
      background: #4752c4;
    }

    .btn-primary:active {
      transform: scale(0.95);
    }

    .btn-secondary {
      background: rgba(79, 84, 92, 0.4);
      color: #b9bbbe;
    }

    .btn-secondary:hover {
      background: rgba(79, 84, 92, 0.6);
    }

    .btn-secondary:active {
      transform: scale(0.95);
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
    .download-progress {
      display: none;
      margin-top: 20px;
    }

    .download-progress.show {
      display: block;
    }

    .download-text {
      font-size: 13px;
      color: #b9bbbe;
      margin-bottom: 12px;
      font-weight: 500;
    }

    .download-bar {
      width: 100%;
      height: 6px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      overflow: hidden;
    }

    .download-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #7289da 0%, #5865f2 100%);
      border-radius: 6px;
      transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
  </style>
</head>
<body>
  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div class="container">
    <!-- –õ–æ–≥–æ—Ç–∏–ø (–∏–∫–æ–Ω–∫–∞ –∫–∞–∫ Discord) -->
    <div class="logo-container">
      <div class="logo-ring"></div>
      <div class="logo-icon">W</div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å —Å –∏–∫–æ–Ω–∫–æ–π -->
    <div class="status" id="status">
      <span class="status-icon" id="statusIcon">‚öôÔ∏è</span>
      <span id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</span>
    </div>
    
    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progress"></div>
      </div>
      <div class="progress-indicator" id="progressIndicator"></div>
      <div class="progress-info">
        <div class="progress-percent" id="progressPercent">0%</div>
        <div class="progress-time" id="progressTime"></div>
      </div>
    </div>
    
    <!-- –í–µ—Ä—Å–∏—è -->
    <div class="version" id="version">v1.0.0</div>
  </div>

  <!-- Skip –∫–Ω–æ–ø–∫–∞ (—Ç–æ–ª—å–∫–æ –≤ dev) -->
  <button class="skip-button" id="skipButton">Skip</button>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
  <div class="update-notification" id="updateNotification">
    <div class="update-icon">‚ú®</div>
    <div class="update-title">–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
    <div class="update-version" id="updateVersion">v1.1.1</div>
    <div class="update-description" id="updateDescription">
      –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
    </div>
    <div class="update-buttons">
      <button class="btn btn-primary" id="btnUpdate">–û–±–Ω–æ–≤–∏—Ç—å</button>
      <button class="btn btn-secondary" id="btnLater">–ü–æ–∑–∂–µ</button>
    </div>
    <div class="download-progress" id="downloadProgress">
      <div class="download-text" id="downloadText">–ó–∞–≥—Ä—É–∑–∫–∞: 0%</div>
      <div class="download-bar">
        <div class="download-bar-fill" id="downloadBar"></div>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    
    let startTime = Date.now();
    let currentPercent = 0;

    // –°—Ç–∞—Ç—É—Å—ã —Å –∏–∫–æ–Ω–∫–∞–º–∏
    const statusIcons = {
      '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è': '‚öôÔ∏è',
      '–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è': 'üì¶',
      '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π': 'üîç',
      '–ì–æ—Ç–æ–≤–æ': '‚úÖ',
      'default': '‚öôÔ∏è'
    };

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å –∏–∫–æ–Ω–∫–æ–π
    ipcRenderer.on('splash-status', (event, message) => {
      const statusEl = document.getElementById('statusText');
      const iconEl = document.getElementById('statusIcon');
      
      // –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â—É—é –∏–∫–æ–Ω–∫—É
      let icon = statusIcons.default;
      for (const [key, value] of Object.entries(statusIcons)) {
        if (message.includes(key)) {
          icon = value;
          break;
        }
      }
      
      statusEl.style.animation = 'none';
      iconEl.style.animation = 'none';
      
      setTimeout(() => {
        statusEl.textContent = message;
        iconEl.textContent = icon;
        statusEl.style.animation = 'statusFade 0.4s cubic-bezier(0.16, 1, 0.3, 1)';
        
        // –ö—Ä—É—Ç—è—â–∞—è—Å—è –∏–∫–æ–Ω–∫–∞ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞
        if (icon !== '‚úÖ') {
          iconEl.style.animation = 'iconSpin 1s linear infinite';
        }
      }, 10);
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º
    ipcRenderer.on('splash-progress', (event, percent) => {
      const progressFill = document.getElementById('progress');
      const progressIndicator = document.getElementById('progressIndicator');
      const progressPercent = document.getElementById('progressPercent');
      const progressTime = document.getElementById('progressTime');
      
      progressFill.style.width = percent + '%';
      progressIndicator.style.left = percent + '%';
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
      if (Math.floor(percent) !== currentPercent) {
        progressPercent.classList.add('updating');
        setTimeout(() => {
          progressPercent.classList.remove('updating');
        }, 300);
      }
      currentPercent = Math.floor(percent);
      progressPercent.textContent = currentPercent + '%';
      
      // –†–∞—Å—á–µ—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
      const elapsed = Date.now() - startTime;
      if (percent > 5) {
        const estimatedTotal = (elapsed / percent) * 100;
        const remaining = Math.max(0, (estimatedTotal - elapsed) / 1000);
        if (remaining > 0 && remaining < 60) {
          progressTime.textContent = `~${Math.ceil(remaining)} —Å–µ–∫`;
        }
      }
    });

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ—Ä—Å–∏–∏
    ipcRenderer.on('splash-version', (event, version) => {
      document.getElementById('version').textContent = 'v' + version;
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å Skip –∫–Ω–æ–ø–∫—É –≤ dev —Ä–µ–∂–∏–º–µ
    ipcRenderer.on('dev-mode', () => {
      document.getElementById('skipButton').classList.add('show');
    });

    // Skip –∫–Ω–æ–ø–∫–∞
    document.getElementById('skipButton').addEventListener('click', () => {
      document.body.classList.add('fade-out');
      setTimeout(() => {
        ipcRenderer.send('skip-update');
      }, 300);
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
    ipcRenderer.on('update-available', (event, info) => {
      const notification = document.getElementById('updateNotification');
      notification.classList.add('show');
      document.getElementById('updateVersion').textContent = 'v' + info.version;
    });

    // –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
    ipcRenderer.on('download-progress', (event, progressObj) => {
      const downloadProgress = document.getElementById('downloadProgress');
      downloadProgress.classList.add('show');
      
      const percent = Math.round(progressObj.percent);
      const downloadBar = document.getElementById('downloadBar');
      
      document.getElementById('downloadText').textContent = `–ó–∞–≥—Ä—É–∑–∫–∞: ${percent}%`;
      downloadBar.style.width = percent + '%';
      
      // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏
      document.querySelector('.update-buttons').style.display = 'none';
    });

    // –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å"
    document.getElementById('btnUpdate').addEventListener('click', () => {
      ipcRenderer.send('start-update');
    });

    // –ö–Ω–æ–ø–∫–∞ "–ü–æ–∑–∂–µ"
    document.getElementById('btnLater').addEventListener('click', () => {
      document.body.classList.add('fade-out');
      setTimeout(() => {
        ipcRenderer.send('skip-update');
      }, 300);
    });

    // Fade out –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
    window.addEventListener('beforeunload', () => {
      document.body.classList.add('fade-out');
    });
  </script>
</body>
</html>
