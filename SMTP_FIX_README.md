# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π email

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–Ø–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–∞** - –¥–æ–±–∞–≤–ª–µ–Ω –ø—É—Ç—å –∫ `.env` –≤ `index.ts`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ SMTP –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. **PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω `ecosystem.config.cjs` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ email

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**Windows (PowerShell):**
```powershell
.\deploy-smtp-fix.ps1
```

**Linux/Mac:**
```bash
chmod +x deploy-smtp-fix.sh
./deploy-smtp-fix.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ —Ñ–∞–π–ª–µ `SMTP_FIX_INSTRUCTIONS.md`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞:**
```bash
ssh root@VM-396498 'pm2 logs woxly-backend --lines 50' | grep SMTP
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
SMTP_USER: ‚úì SET
SMTP_PASS: ‚úì SET
SMTP_HOST: smtp.gmail.com
```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email:**
```bash
curl -X POST https://woxly.ru/api/auth/request-password-reset \
  -H "Content-Type: application/json" \
  -d '{"email":"ilyalove130919@gmail.com"}'
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏:**
```bash
ssh root@VM-396498 'pm2 logs woxly-backend --lines 20' | grep -i "email\|smtp"
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
Attempting to send –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è email to ilyalove130919@gmail.com
SMTP Config: { host: 'smtp.gmail.com', ... }
Email sent successfully to ilyalove130919@gmail.com: <message-id>
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø–∏—Å—å–º–∞ –≤—Å–µ –µ—â–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
ssh root@VM-396498 'cat /var/www/woxly/apps/backend/.env | grep SMTP'
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Gmail App Password:**
   - –ó–∞–π—Ç–∏ –≤ https://myaccount.google.com/apppasswords
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ 2FA –≤–∫–ª—é—á–µ–Ω–∞
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π App Password –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏:**
```bash
ssh root@VM-396498 'pm2 logs woxly-backend --lines 100 --err'
```

## üìù –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- ‚úÖ `apps/backend/src/index.ts` - —è–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ .env
- ‚úÖ `apps/backend/src/utils/email.ts` - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:
- ‚úÖ `apps/backend/ecosystem.config.cjs` - PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `deploy-smtp-fix.sh` - —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –¥–ª—è Linux/Mac
- ‚úÖ `deploy-smtp-fix.ps1` - —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –¥–ª—è Windows
- ‚úÖ `SMTP_FIX_INSTRUCTIONS.md` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## ‚ùì –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —Å dotenv-cli:

```bash
ssh root@VM-396498
cd /var/www/woxly/apps/backend
npm install -g dotenv-cli
pm2 delete woxly-backend
pm2 start "dotenv -e .env node dist/index.js" --name woxly-backend
pm2 save
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –§–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
2. Gmail –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É Spam –≤ –ø–æ—á—Ç–µ
